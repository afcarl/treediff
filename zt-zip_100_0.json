{
  "script": [
    [
      "add",
      {
        "col": 25,
        "line": 63,
        "offset": 2084
      },
      {
        "col": 30,
        "line": 63,
        "offset": 2089
      }
    ],
    [
      "add",
      {
        "col": 22,
        "line": 66,
        "offset": 2162
      },
      {
        "col": 36,
        "line": 66,
        "offset": 2176
      }
    ],
    [
      "add",
      {
        "col": 12,
        "line": 81,
        "offset": 2571
      },
      {
        "col": 22,
        "line": 81,
        "offset": 2581
      }
    ],
    [
      "add",
      {
        "col": 30,
        "line": 71,
        "offset": 2354
      },
      {
        "col": 38,
        "line": 71,
        "offset": 2362
      }
    ],
    [
      "add",
      {
        "col": 9,
        "line": 76,
        "offset": 2463
      },
      {
        "col": 16,
        "line": 76,
        "offset": 2470
      }
    ],
    [
      "add",
      {
        "col": 25,
        "line": 81,
        "offset": 2584
      },
      {
        "col": 29,
        "line": 81,
        "offset": 2588
      }
    ],
    [
      "add",
      {
        "col": 46,
        "line": 91,
        "offset": 2971
      },
      {
        "col": 52,
        "line": 91,
        "offset": 2977
      }
    ],
    [
      "add",
      {
        "col": 3,
        "line": 62,
        "offset": 1992
      },
      {
        "col": 4,
        "line": 96,
        "offset": 3068
      }
    ],
    [
      "add",
      {
        "col": 11,
        "line": 63,
        "offset": 2070
      },
      {
        "col": 17,
        "line": 63,
        "offset": 2076
      }
    ],
    [
      "add",
      {
        "col": 7,
        "line": 68,
        "offset": 2210
      },
      {
        "col": 29,
        "line": 68,
        "offset": 2232
      }
    ],
    [
      "add",
      {
        "col": 56,
        "line": 62,
        "offset": 2045
      },
      {
        "col": 67,
        "line": 62,
        "offset": 2056
      }
    ],
    [
      "add",
      {
        "col": 27,
        "line": 87,
        "offset": 2849
      },
      {
        "col": 31,
        "line": 87,
        "offset": 2853
      }
    ],
    [
      "add",
      {
        "col": 24,
        "line": 91,
        "offset": 2949
      },
      {
        "col": 30,
        "line": 91,
        "offset": 2955
      }
    ],
    [
      "add",
      {
        "col": 31,
        "line": 94,
        "offset": 3050
      },
      {
        "col": 35,
        "line": 94,
        "offset": 3054
      }
    ],
    [
      "add",
      {
        "col": 16,
        "line": 16,
        "offset": 696
      },
      {
        "col": 35,
        "line": 16,
        "offset": 715
      }
    ],
    [
      "add",
      {
        "col": 16,
        "line": 20,
        "offset": 822
      },
      {
        "col": 26,
        "line": 20,
        "offset": 832
      }
    ],
    [
      "add",
      {
        "col": 33,
        "line": 69,
        "offset": 2266
      },
      {
        "col": 48,
        "line": 69,
        "offset": 2281
      }
    ],
    [
      "add",
      {
        "col": 13,
        "line": 72,
        "offset": 2384
      },
      {
        "col": 18,
        "line": 72,
        "offset": 2389
      }
    ],
    [
      "add",
      {
        "col": 27,
        "line": 86,
        "offset": 2758
      },
      {
        "col": 30,
        "line": 86,
        "offset": 2761
      }
    ],
    [
      "add",
      {
        "col": 33,
        "line": 79,
        "offset": 2534
      },
      {
        "col": 48,
        "line": 79,
        "offset": 2549
      }
    ],
    [
      "add",
      {
        "col": 18,
        "line": 64,
        "offset": 2109
      },
      {
        "col": 26,
        "line": 64,
        "offset": 2117
      }
    ],
    [
      "add",
      {
        "col": 70,
        "line": 69,
        "offset": 2303
      },
      {
        "col": 74,
        "line": 69,
        "offset": 2307
      }
    ],
    [
      "add",
      {
        "col": 7,
        "line": 69,
        "offset": 2240
      },
      {
        "col": 22,
        "line": 69,
        "offset": 2255
      }
    ],
    [
      "add",
      {
        "col": 27,
        "line": 88,
        "offset": 2888
      },
      {
        "col": 33,
        "line": 88,
        "offset": 2894
      }
    ],
    [
      "add",
      {
        "col": 11,
        "line": 89,
        "offset": 2908
      },
      {
        "col": 16,
        "line": 89,
        "offset": 2913
      }
    ],
    [
      "add",
      {
        "col": 1,
        "line": 16,
        "offset": 681
      },
      {
        "col": 36,
        "line": 16,
        "offset": 716
      }
    ],
    [
      "add",
      {
        "col": 3,
        "line": 62,
        "offset": 1992
      },
      {
        "col": 9,
        "line": 62,
        "offset": 1998
      }
    ],
    [
      "add",
      {
        "col": 29,
        "line": 64,
        "offset": 2120
      },
      {
        "col": 34,
        "line": 64,
        "offset": 2125
      }
    ],
    [
      "add",
      {
        "col": 23,
        "line": 79,
        "offset": 2524
      },
      {
        "col": 26,
        "line": 79,
        "offset": 2527
      }
    ],
    [
      "add",
      {
        "col": 7,
        "line": 79,
        "offset": 2508
      },
      {
        "col": 22,
        "line": 79,
        "offset": 2523
      }
    ],
    [
      "add",
      {
        "col": 32,
        "line": 83,
        "offset": 2660
      },
      {
        "col": 43,
        "line": 83,
        "offset": 2671
      }
    ],
    [
      "add",
      {
        "col": 5,
        "line": 63,
        "offset": 2064
      },
      {
        "col": 10,
        "line": 63,
        "offset": 2069
      }
    ],
    [
      "add",
      {
        "col": 13,
        "line": 71,
        "offset": 2337
      },
      {
        "col": 25,
        "line": 71,
        "offset": 2349
      }
    ],
    [
      "add",
      {
        "col": 55,
        "line": 83,
        "offset": 2683
      },
      {
        "col": 65,
        "line": 83,
        "offset": 2693
      }
    ],
    [
      "add",
      {
        "col": 7,
        "line": 88,
        "offset": 2868
      },
      {
        "col": 10,
        "line": 88,
        "offset": 2871
      }
    ],
    [
      "add",
      {
        "col": 64,
        "line": 91,
        "offset": 2989
      },
      {
        "col": 68,
        "line": 91,
        "offset": 2993
      }
    ],
    [
      "add",
      {
        "col": 37,
        "line": 86,
        "offset": 2768
      },
      {
        "col": 56,
        "line": 86,
        "offset": 2787
      }
    ],
    [
      "add",
      {
        "col": 37,
        "line": 66,
        "offset": 2177
      },
      {
        "col": 43,
        "line": 66,
        "offset": 2183
      }
    ],
    [
      "add",
      {
        "col": 17,
        "line": 76,
        "offset": 2471
      },
      {
        "col": 29,
        "line": 76,
        "offset": 2483
      }
    ],
    [
      "add",
      {
        "col": 30,
        "line": 81,
        "offset": 2589
      },
      {
        "col": 44,
        "line": 81,
        "offset": 2603
      }
    ],
    [
      "add",
      {
        "col": 7,
        "line": 86,
        "offset": 2738
      },
      {
        "col": 26,
        "line": 86,
        "offset": 2757
      }
    ],
    [
      "add",
      {
        "col": 14,
        "line": 87,
        "offset": 2836
      },
      {
        "col": 20,
        "line": 87,
        "offset": 2842
      }
    ],
    [
      "add",
      {
        "col": 7,
        "line": 84,
        "offset": 2703
      },
      {
        "col": 17,
        "line": 84,
        "offset": 2713
      }
    ],
    [
      "add",
      {
        "col": 7,
        "line": 94,
        "offset": 3026
      },
      {
        "col": 16,
        "line": 94,
        "offset": 3035
      }
    ],
    [
      "add",
      {
        "col": 15,
        "line": 62,
        "offset": 2004
      },
      {
        "col": 46,
        "line": 62,
        "offset": 2035
      }
    ],
    [
      "add",
      {
        "col": 5,
        "line": 66,
        "offset": 2145
      },
      {
        "col": 9,
        "line": 66,
        "offset": 2149
      }
    ],
    [
      "add",
      {
        "col": 19,
        "line": 72,
        "offset": 2390
      },
      {
        "col": 27,
        "line": 72,
        "offset": 2398
      }
    ],
    [
      "add",
      {
        "col": 11,
        "line": 88,
        "offset": 2872
      },
      {
        "col": 15,
        "line": 88,
        "offset": 2876
      }
    ],
    [
      "add",
      {
        "col": 8,
        "line": 16,
        "offset": 688
      },
      {
        "col": 12,
        "line": 16,
        "offset": 692
      }
    ],
    [
      "add",
      {
        "col": 8,
        "line": 20,
        "offset": 814
      },
      {
        "col": 12,
        "line": 20,
        "offset": 818
      }
    ],
    [
      "add",
      {
        "col": 11,
        "line": 64,
        "offset": 2102
      },
      {
        "col": 15,
        "line": 64,
        "offset": 2106
      }
    ],
    [
      "add",
      {
        "col": 9,
        "line": 73,
        "offset": 2410
      },
      {
        "col": 12,
        "line": 73,
        "offset": 2413
      }
    ],
    [
      "add",
      {
        "col": 18,
        "line": 88,
        "offset": 2879
      },
      {
        "col": 21,
        "line": 88,
        "offset": 2882
      }
    ],
    [
      "add",
      {
        "col": 77,
        "line": 86,
        "offset": 2808
      },
      {
        "col": 87,
        "line": 86,
        "offset": 2818
      }
    ],
    [
      "add",
      {
        "col": 10,
        "line": 62,
        "offset": 1999
      },
      {
        "col": 14,
        "line": 62,
        "offset": 2003
      }
    ],
    [
      "add",
      {
        "col": 35,
        "line": 64,
        "offset": 2126
      },
      {
        "col": 43,
        "line": 64,
        "offset": 2134
      }
    ],
    [
      "add",
      {
        "col": 53,
        "line": 69,
        "offset": 2286
      },
      {
        "col": 69,
        "line": 69,
        "offset": 2302
      }
    ],
    [
      "add",
      {
        "col": 44,
        "line": 83,
        "offset": 2672
      },
      {
        "col": 47,
        "line": 83,
        "offset": 2675
      }
    ],
    [
      "add",
      {
        "col": 53,
        "line": 91,
        "offset": 2978
      },
      {
        "col": 59,
        "line": 91,
        "offset": 2984
      }
    ],
    [
      "add",
      {
        "col": 1,
        "line": 20,
        "offset": 807
      },
      {
        "col": 27,
        "line": 20,
        "offset": 833
      }
    ],
    [
      "add",
      {
        "col": 10,
        "line": 66,
        "offset": 2150
      },
      {
        "col": 14,
        "line": 66,
        "offset": 2154
      }
    ],
    [
      "add",
      {
        "col": 9,
        "line": 72,
        "offset": 2380
      },
      {
        "col": 12,
        "line": 72,
        "offset": 2383
      }
    ],
    [
      "add",
      {
        "col": 49,
        "line": 79,
        "offset": 2550
      },
      {
        "col": 53,
        "line": 79,
        "offset": 2554
      }
    ],
    [
      "add",
      {
        "col": 18,
        "line": 63,
        "offset": 2077
      },
      {
        "col": 22,
        "line": 63,
        "offset": 2081
      }
    ],
    [
      "add",
      {
        "col": 17,
        "line": 66,
        "offset": 2157
      },
      {
        "col": 21,
        "line": 66,
        "offset": 2161
      }
    ],
    [
      "add",
      {
        "col": 39,
        "line": 71,
        "offset": 2363
      },
      {
        "col": 43,
        "line": 71,
        "offset": 2367
      }
    ],
    [
      "add",
      {
        "col": 61,
        "line": 91,
        "offset": 2986
      },
      {
        "col": 62,
        "line": 91,
        "offset": 2987
      }
    ],
    [
      "add",
      {
        "col": 30,
        "line": 76,
        "offset": 2484
      },
      {
        "col": 33,
        "line": 76,
        "offset": 2487
      }
    ],
    [
      "add",
      {
        "col": 45,
        "line": 81,
        "offset": 2604
      },
      {
        "col": 58,
        "line": 81,
        "offset": 2617
      }
    ],
    [
      "add",
      {
        "col": 32,
        "line": 87,
        "offset": 2854
      },
      {
        "col": 36,
        "line": 87,
        "offset": 2858
      }
    ],
    [
      "add",
      {
        "col": 61,
        "line": 86,
        "offset": 2792
      },
      {
        "col": 76,
        "line": 86,
        "offset": 2807
      }
    ],
    [
      "add",
      {
        "col": 31,
        "line": 91,
        "offset": 2956
      },
      {
        "col": 39,
        "line": 91,
        "offset": 2964
      }
    ],
    [
      "add",
      {
        "col": 18,
        "line": 84,
        "offset": 2714
      },
      {
        "col": 24,
        "line": 84,
        "offset": 2720
      }
    ],
    [
      "add",
      {
        "col": 17,
        "line": 94,
        "offset": 3036
      },
      {
        "col": 30,
        "line": 94,
        "offset": 3049
      }
    ],
    [
      "add",
      {
        "col": 23,
        "line": 69,
        "offset": 2256
      },
      {
        "col": 26,
        "line": 69,
        "offset": 2259
      }
    ],
    [
      "add",
      {
        "col": 5,
        "line": 64,
        "offset": 2096
      },
      {
        "col": 10,
        "line": 64,
        "offset": 2101
      }
    ],
    [
      "add",
      {
        "col": 7,
        "line": 81,
        "offset": 2566
      },
      {
        "col": 11,
        "line": 81,
        "offset": 2570
      }
    ],
    [
      "add",
      {
        "col": 7,
        "line": 83,
        "offset": 2635
      },
      {
        "col": 14,
        "line": 83,
        "offset": 2642
      }
    ],
    [
      "add",
      {
        "col": 9,
        "line": 71,
        "offset": 2333
      },
      {
        "col": 12,
        "line": 71,
        "offset": 2336
      }
    ],
    [
      "add",
      {
        "col": 13,
        "line": 16,
        "offset": 693
      },
      {
        "col": 15,
        "line": 16,
        "offset": 695
      }
    ],
    [
      "add",
      {
        "col": 13,
        "line": 20,
        "offset": 819
      },
      {
        "col": 15,
        "line": 20,
        "offset": 821
      }
    ],
    [
      "add",
      {
        "col": 13,
        "line": 73,
        "offset": 2414
      },
      {
        "col": 23,
        "line": 73,
        "offset": 2424
      }
    ],
    [
      "add",
      {
        "col": 15,
        "line": 83,
        "offset": 2643
      },
      {
        "col": 21,
        "line": 83,
        "offset": 2649
      }
    ],
    [
      "add",
      {
        "col": 7,
        "line": 87,
        "offset": 2829
      },
      {
        "col": 11,
        "line": 87,
        "offset": 2833
      }
    ],
    [
      "add",
      {
        "col": 22,
        "line": 88,
        "offset": 2883
      },
      {
        "col": 26,
        "line": 88,
        "offset": 2887
      }
    ],
    [
      "add",
      {
        "col": 7,
        "line": 89,
        "offset": 2904
      },
      {
        "col": 10,
        "line": 89,
        "offset": 2907
      }
    ],
    [
      "add",
      {
        "col": 7,
        "line": 91,
        "offset": 2932
      },
      {
        "col": 19,
        "line": 91,
        "offset": 2944
      }
    ],
    [
      "add",
      {
        "col": 24,
        "line": 83,
        "offset": 2652
      },
      {
        "col": 31,
        "line": 83,
        "offset": 2659
      }
    ],
    [
      "add",
      {
        "col": 49,
        "line": 83,
        "offset": 2677
      },
      {
        "col": 53,
        "line": 83,
        "offset": 2681
      }
    ]
  ],
  "src_after": "/**\n *    Copyright (C) 2012 ZeroTurnaround LLC <support@zeroturnaround.com>\n *\n *    Licensed under the Apache License, Version 2.0 (the \"License\");\n *    you may not use this file except in compliance with the License.\n *    You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n *    Unless required by applicable law or agreed to in writing, software\n *    distributed under the License is distributed on an \"AS IS\" BASIS,\n *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *    See the License for the specific language governing permissions and\n *    limitations under the License.\n */\nimport java.io.BufferedInputStream;\nimport java.io.File;\nimport java.io.FileInputStream;\nimport java.io.FileOutputStream;\nimport java.io.FileReader;\nimport java.io.IOException;\nimport java.util.zip.ZipEntry;\nimport java.util.zip.ZipOutputStream;\n\nimport junit.framework.TestCase;\n\nimport org.apache.commons.io.FileUtils;\nimport org.apache.commons.io.IOUtils;\nimport org.zeroturnaround.zip.ZipEntrySource;\nimport org.zeroturnaround.zip.ZipException;\nimport org.zeroturnaround.zip.ZipUtil;\n\npublic class ZipUtilTest extends TestCase {\n\n  public void testUnpackEntryFromFile() throws IOException {\n    final String name = \"foo\";\n    final byte[] contents = \"bar\".getBytes();\n\n    File file = File.createTempFile(\"temp\", null);\n    try {\n      // Create the ZIP file\n      ZipOutputStream zos = new ZipOutputStream(new FileOutputStream(file));\n      try {\n        zos.putNextEntry(new ZipEntry(name));\n        zos.write(contents);\n        zos.closeEntry();\n      }\n      finally {\n        IOUtils.closeQuietly(zos);\n      }\n\n      // Test the ZipUtil\n      byte[] actual = ZipUtil.unpackEntry(file, name);\n      assertNotNull(actual);\n      assertEquals(new String(contents), new String(actual));\n    }\n    finally {\n      FileUtils.deleteQuietly(file);\n    }\n  }\n  \n  public void testUnpackEntryFromStreamToFile() throws IOException {\n    final String name = \"foo\";\n    final byte[] contents = \"bar\".getBytes();\n\n    File file = File.createTempFile(\"temp\", null);\n    try {\n      // Create the ZIP file\n      ZipOutputStream zos = new ZipOutputStream(new FileOutputStream(file));\n      try {\n        zos.putNextEntry(new ZipEntry(name));\n        zos.write(contents);\n        zos.closeEntry();\n      }\n      finally {\n        IOUtils.closeQuietly(zos);\n      }\n\n      FileInputStream fis = new FileInputStream(file);\n\n      File outputFile = File.createTempFile(\"temp-output\", null);\n\n      boolean result = ZipUtil.unpackEntry(fis, name, outputFile);\n      assertTrue(result);\n      \n      BufferedInputStream bis = new BufferedInputStream(new FileInputStream(outputFile));\n      byte[] actual = new byte[1024];\n      int read = bis.read(actual);\n      bis.close();\n      \n      assertEquals(new String(contents), new String(actual, 0, read));\n    }\n    finally {\n      FileUtils.deleteQuietly(file);\n    }\n  }\n  \n  public void testUnpackEntryFromStream() throws IOException {\n    final String name = \"foo\";\n    final byte[] contents = \"bar\".getBytes();\n\n    File file = File.createTempFile(\"temp\", null);\n    try {\n      // Create the ZIP file\n      ZipOutputStream zos = new ZipOutputStream(new FileOutputStream(file));\n      try {\n        zos.putNextEntry(new ZipEntry(name));\n        zos.write(contents);\n        zos.closeEntry();\n      }\n      finally {\n        IOUtils.closeQuietly(zos);\n      }\n\n      FileInputStream fis = new FileInputStream(file);\n      // Test the ZipUtil\n      byte[] actual = ZipUtil.unpackEntry(fis, name);\n      assertNotNull(actual);\n      assertEquals(new String(contents), new String(actual));\n    }\n    finally {\n      FileUtils.deleteQuietly(file);\n    }\n  }\n\n  public void testDuplicateEntryAtAdd() throws IOException {\n    File src = new File(getClass().getResource(\"duplicate.zip\").getPath());\n\n    File dest = File.createTempFile(\"temp\", null);\n    try {\n      ZipUtil.addEntries(src, new ZipEntrySource[0], dest);\n    }\n    finally {\n      FileUtils.deleteQuietly(dest);\n    }\n  }\n\n  public void testDuplicateEntryAtReplace() throws IOException {\n    File src = new File(getClass().getResource(\"duplicate.zip\").getPath());\n\n    File dest = File.createTempFile(\"temp\", null);\n    try {\n      ZipUtil.replaceEntries(src, new ZipEntrySource[0], dest);\n    }\n    finally {\n      FileUtils.deleteQuietly(dest);\n    }\n  }\n\n  public void testDuplicateEntryAtAddOrReplace() throws IOException {\n    File src = new File(getClass().getResource(\"duplicate.zip\").getPath());\n\n    File dest = File.createTempFile(\"temp\", null);\n    try {\n      ZipUtil.addOrReplaceEntries(src, new ZipEntrySource[0], dest);\n    }\n    finally {\n      FileUtils.deleteQuietly(dest);\n    }\n  }\n\n  public void testUnexplode() throws IOException {\n    File file = File.createTempFile(\"tempFile\", null);\n    File tmpDir = file.getParentFile();\n\n    unexplodeWithException(file, \"shouldn't be able to unexplode file that is not a directory\");\n    assertTrue(\"Should be able to delete tmp file\", file.delete());\n    unexplodeWithException(file, \"shouldn't be able to unexplode file that doesn't exist\");\n\n    // create empty tmp dir with the same name as deleted file\n    File dir = new File(tmpDir, file.getName());\n    dir.deleteOnExit();\n    assertTrue(\"Should be able to create directory with the same name as there was tmp file\", dir.mkdir());\n\n    unexplodeWithException(dir, \"shouldn't be able to unexplode dir that doesn't contain any files\");\n\n    // unexplode should succeed with at least one file in directory\n    File.createTempFile(\"temp\", null, dir);\n    ZipUtil.unexplode(dir);\n\n    assertTrue(\"zip file should exist with the same name as the directory that was unexploded\", dir.exists());\n    assertTrue(\"unexploding input directory should have produced zip file with the same name\", !dir.isDirectory());\n    assertTrue(\"Should be able to delete zip that was created from directory\", dir.delete());\n  }\n\n  public void testPackEntry() throws Exception {\n    File fileToPack = new File(getClass().getResource(\"TestFile.txt\").getPath());\n    File dest = File.createTempFile(\"temp\", null);\n    ZipUtil.packEntry(fileToPack, dest);\n    assertTrue(dest.exists());\n\n    ZipUtil.explode(dest);\n    assertTrue((new File(dest, \"TestFile.txt\")).exists());\n    // if fails then maybe somebody changed the file contents and did not update\n    // the test\n    assertEquals(108, (new File(dest, \"TestFile.txt\")).length());\n  }\n\n  public void testPackEntries() throws Exception {\n    File fileToPack = new File(getClass().getResource(\"TestFile.txt\").getPath());\n    File fileToPackII = new File(getClass().getResource(\"TestFile-II.txt\").getPath());\n    File dest = File.createTempFile(\"temp\", null);\n    ZipUtil.packEntries(new File[] { fileToPack, fileToPackII }, dest);\n    assertTrue(dest.exists());\n\n    ZipUtil.explode(dest);\n    assertTrue((new File(dest, \"TestFile.txt\")).exists());\n    assertTrue((new File(dest, \"TestFile-II.txt\")).exists());\n    // if fails then maybe somebody changed the file contents and did not update\n    // the test\n    assertEquals(108, (new File(dest, \"TestFile.txt\")).length());\n    assertEquals(103, (new File(dest, \"TestFile-II.txt\")).length());\n  }\n\n  public void testZipException() {\n    boolean exceptionThrown = false;\n    try {\n      ZipUtil.pack(new File(\"nonExistent\"), new File(\"weeheha\"));\n    }\n    catch (ZipException e) {\n      exceptionThrown = true;\n    }\n    assertTrue(exceptionThrown);\n  }\n\n  public void testPreserveRoot() throws Exception {\n    File dest = File.createTempFile(\"temp\", null);\n    File parent = new File(getClass().getResource(\"TestFile.txt\").getPath()).getParentFile();\n    ZipUtil.pack(parent, dest, true);\n    ZipUtil.explode(dest);\n    assertTrue((new File(dest, parent.getName())).exists());\n  }\n\n  private void unexplodeWithException(File file, String message) {\n    boolean ok = false;\n    try {\n      ZipUtil.unexplode(file);\n    }\n    catch (Exception e) {\n      ok = true;\n    }\n    assertTrue(message, ok);\n  }\n\n  public void testArchiveEquals() {\n    File src = new File(getClass().getResource(\"demo.zip\").getPath());\n    // byte-by-byte copy\n    File src2 = new File(getClass().getResource(\"demo-copy.zip\").getPath());\n    assertTrue(ZipUtil.archiveEquals(src, src2));\n    \n    // entry by entry copy\n    File src3 = new File(getClass().getResource(\"demo-copy-II.zip\").getPath());\n    assertTrue(ZipUtil.archiveEquals(src, src3));\n  }\n  \n  public void testRepackArchive() throws IOException {\n    File src = new File(getClass().getResource(\"demo.zip\").getPath());\n    File dest = File.createTempFile(\"temp\", null);\n\n    ZipUtil.repack(src, dest, 1);\n\n    assertTrue(ZipUtil.archiveEquals(src, dest));\n  }\n\n\n  public void testContainsAnyEntry() throws IOException {\n    File src = new File(getClass().getResource(\"demo.zip\").getPath());\n    boolean exists = ZipUtil.containsAnyEntry(src, new String[] { \"foo.txt\", \"bar.txt\" });\n    assertTrue(exists);\n\n    exists = ZipUtil.containsAnyEntry(src, new String[] { \"foo.txt\", \"does-not-exist.txt\" });\n    assertTrue(exists);\n\n    exists = ZipUtil.containsAnyEntry(src, new String[] { \"does-not-exist-I.txt\", \"does-not-exist-II.txt\" });\n    assertFalse(exists);\n  }\n\n  public void testAddEntry() throws IOException {\n    File src = new File(getClass().getResource(\"demo.zip\").getPath());\n    final String fileName = \"TestFile.txt\";\n    assertFalse(ZipUtil.containsEntry(src, fileName));\n    File newEntry = new File(getClass().getResource(fileName).getPath());\n    File dest = File.createTempFile(\"temp.zip\", null);\n\n    ZipUtil.addEntry(src, fileName, newEntry, dest);\n    assertTrue(ZipUtil.containsEntry(dest, fileName));\n  }\n\n  public void testRemoveEntry() throws IOException {\n    File src = new File(getClass().getResource(\"demo.zip\").getPath());\n\n    File dest = File.createTempFile(\"temp\", null);\n    try {\n      ZipUtil.removeEntry(src, \"bar.txt\", dest);\n      assertTrue(\"Result zip misses entry 'foo.txt'\", ZipUtil.containsEntry(dest, \"foo.txt\"));\n      assertTrue(\"Result zip misses entry 'foo1.txt'\", ZipUtil.containsEntry(dest, \"foo1.txt\"));\n      assertTrue(\"Result zip misses entry 'foo2.txt'\", ZipUtil.containsEntry(dest, \"foo2.txt\"));\n      assertFalse(\"Result zip still contains 'bar.txt'\", ZipUtil.containsEntry(dest, \"bar.txt\"));\n    }\n    finally {\n      FileUtils.deleteQuietly(dest);\n    }\n  }\n\n  public void testRemoveDirs() throws IOException {\n    File src = new File(getClass().getResource(\"demo-dirs.zip\").getPath());\n\n    File dest = File.createTempFile(\"temp\", null);\n    try {\n      ZipUtil.removeEntries(src, new String[] { \"bar.txt\", \"a/b\" }, dest);\n\n      assertFalse(\"Result zip still contains 'bar.txt'\", ZipUtil.containsEntry(dest, \"bar.txt\"));\n      assertFalse(\"Result zip still contains dir 'a/b'\", ZipUtil.containsEntry(dest, \"a/b\"));\n      assertTrue(\"Result doesn't containt 'attic'\", ZipUtil.containsEntry(dest, \"attic/treasure.txt\"));\n      assertTrue(\"Entry whose prefix is dir name is removed too: 'b.txt'\", ZipUtil.containsEntry(dest, \"a/b.txt\"));\n      assertFalse(\"Entry in a removed dir is still there: 'a/b/c.txt'\", ZipUtil.containsEntry(dest, \"a/b/c.txt\"));\n\n    }\n    finally {\n      FileUtils.deleteQuietly(dest);\n    }\n  }\n}\n",
  "src_before": "/**\n *    Copyright (C) 2012 ZeroTurnaround LLC <support@zeroturnaround.com>\n *\n *    Licensed under the Apache License, Version 2.0 (the \"License\");\n *    you may not use this file except in compliance with the License.\n *    You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n *    Unless required by applicable law or agreed to in writing, software\n *    distributed under the License is distributed on an \"AS IS\" BASIS,\n *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *    See the License for the specific language governing permissions and\n *    limitations under the License.\n */\nimport java.io.File;\nimport java.io.FileInputStream;\nimport java.io.FileOutputStream;\nimport java.io.IOException;\nimport java.util.zip.ZipEntry;\nimport java.util.zip.ZipOutputStream;\n\nimport junit.framework.TestCase;\n\nimport org.apache.commons.io.FileUtils;\nimport org.apache.commons.io.IOUtils;\nimport org.zeroturnaround.zip.ZipEntrySource;\nimport org.zeroturnaround.zip.ZipException;\nimport org.zeroturnaround.zip.ZipUtil;\n\npublic class ZipUtilTest extends TestCase {\n\n  public void testUnpackEntryFromFile() throws IOException {\n    final String name = \"foo\";\n    final byte[] contents = \"bar\".getBytes();\n\n    File file = File.createTempFile(\"temp\", null);\n    try {\n      // Create the ZIP file\n      ZipOutputStream zos = new ZipOutputStream(new FileOutputStream(file));\n      try {\n        zos.putNextEntry(new ZipEntry(name));\n        zos.write(contents);\n        zos.closeEntry();\n      }\n      finally {\n        IOUtils.closeQuietly(zos);\n      }\n\n      // Test the ZipUtil\n      byte[] actual = ZipUtil.unpackEntry(file, name);\n      assertNotNull(actual);\n      assertEquals(new String(contents), new String(actual));\n    }\n    finally {\n      FileUtils.deleteQuietly(file);\n    }\n  }\n  \n  public void testUnpackEntryFromStream() throws IOException {\n    final String name = \"foo\";\n    final byte[] contents = \"bar\".getBytes();\n\n    File file = File.createTempFile(\"temp\", null);\n    try {\n      // Create the ZIP file\n      ZipOutputStream zos = new ZipOutputStream(new FileOutputStream(file));\n      try {\n        zos.putNextEntry(new ZipEntry(name));\n        zos.write(contents);\n        zos.closeEntry();\n      }\n      finally {\n        IOUtils.closeQuietly(zos);\n      }\n\n      FileInputStream fis = new FileInputStream(file);\n      // Test the ZipUtil\n      byte[] actual = ZipUtil.unpackEntry(fis, name);\n      assertNotNull(actual);\n      assertEquals(new String(contents), new String(actual));\n    }\n    finally {\n      FileUtils.deleteQuietly(file);\n    }\n  }\n\n  public void testDuplicateEntryAtAdd() throws IOException {\n    File src = new File(getClass().getResource(\"duplicate.zip\").getPath());\n\n    File dest = File.createTempFile(\"temp\", null);\n    try {\n      ZipUtil.addEntries(src, new ZipEntrySource[0], dest);\n    }\n    finally {\n      FileUtils.deleteQuietly(dest);\n    }\n  }\n\n  public void testDuplicateEntryAtReplace() throws IOException {\n    File src = new File(getClass().getResource(\"duplicate.zip\").getPath());\n\n    File dest = File.createTempFile(\"temp\", null);\n    try {\n      ZipUtil.replaceEntries(src, new ZipEntrySource[0], dest);\n    }\n    finally {\n      FileUtils.deleteQuietly(dest);\n    }\n  }\n\n  public void testDuplicateEntryAtAddOrReplace() throws IOException {\n    File src = new File(getClass().getResource(\"duplicate.zip\").getPath());\n\n    File dest = File.createTempFile(\"temp\", null);\n    try {\n      ZipUtil.addOrReplaceEntries(src, new ZipEntrySource[0], dest);\n    }\n    finally {\n      FileUtils.deleteQuietly(dest);\n    }\n  }\n\n  public void testUnexplode() throws IOException {\n    File file = File.createTempFile(\"tempFile\", null);\n    File tmpDir = file.getParentFile();\n\n    unexplodeWithException(file, \"shouldn't be able to unexplode file that is not a directory\");\n    assertTrue(\"Should be able to delete tmp file\", file.delete());\n    unexplodeWithException(file, \"shouldn't be able to unexplode file that doesn't exist\");\n\n    // create empty tmp dir with the same name as deleted file\n    File dir = new File(tmpDir, file.getName());\n    dir.deleteOnExit();\n    assertTrue(\"Should be able to create directory with the same name as there was tmp file\", dir.mkdir());\n\n    unexplodeWithException(dir, \"shouldn't be able to unexplode dir that doesn't contain any files\");\n\n    // unexplode should succeed with at least one file in directory\n    File.createTempFile(\"temp\", null, dir);\n    ZipUtil.unexplode(dir);\n\n    assertTrue(\"zip file should exist with the same name as the directory that was unexploded\", dir.exists());\n    assertTrue(\"unexploding input directory should have produced zip file with the same name\", !dir.isDirectory());\n    assertTrue(\"Should be able to delete zip that was created from directory\", dir.delete());\n  }\n\n  public void testPackEntry() throws Exception {\n    File fileToPack = new File(getClass().getResource(\"TestFile.txt\").getPath());\n    File dest = File.createTempFile(\"temp\", null);\n    ZipUtil.packEntry(fileToPack, dest);\n    assertTrue(dest.exists());\n\n    ZipUtil.explode(dest);\n    assertTrue((new File(dest, \"TestFile.txt\")).exists());\n    // if fails then maybe somebody changed the file contents and did not update\n    // the test\n    assertEquals(108, (new File(dest, \"TestFile.txt\")).length());\n  }\n\n  public void testPackEntries() throws Exception {\n    File fileToPack = new File(getClass().getResource(\"TestFile.txt\").getPath());\n    File fileToPackII = new File(getClass().getResource(\"TestFile-II.txt\").getPath());\n    File dest = File.createTempFile(\"temp\", null);\n    ZipUtil.packEntries(new File[] { fileToPack, fileToPackII }, dest);\n    assertTrue(dest.exists());\n\n    ZipUtil.explode(dest);\n    assertTrue((new File(dest, \"TestFile.txt\")).exists());\n    assertTrue((new File(dest, \"TestFile-II.txt\")).exists());\n    // if fails then maybe somebody changed the file contents and did not update\n    // the test\n    assertEquals(108, (new File(dest, \"TestFile.txt\")).length());\n    assertEquals(103, (new File(dest, \"TestFile-II.txt\")).length());\n  }\n\n  public void testZipException() {\n    boolean exceptionThrown = false;\n    try {\n      ZipUtil.pack(new File(\"nonExistent\"), new File(\"weeheha\"));\n    }\n    catch (ZipException e) {\n      exceptionThrown = true;\n    }\n    assertTrue(exceptionThrown);\n  }\n\n  public void testPreserveRoot() throws Exception {\n    File dest = File.createTempFile(\"temp\", null);\n    File parent = new File(getClass().getResource(\"TestFile.txt\").getPath()).getParentFile();\n    ZipUtil.pack(parent, dest, true);\n    ZipUtil.explode(dest);\n    assertTrue((new File(dest, parent.getName())).exists());\n  }\n\n  private void unexplodeWithException(File file, String message) {\n    boolean ok = false;\n    try {\n      ZipUtil.unexplode(file);\n    }\n    catch (Exception e) {\n      ok = true;\n    }\n    assertTrue(message, ok);\n  }\n\n  public void testArchiveEquals() {\n    File src = new File(getClass().getResource(\"demo.zip\").getPath());\n    // byte-by-byte copy\n    File src2 = new File(getClass().getResource(\"demo-copy.zip\").getPath());\n    assertTrue(ZipUtil.archiveEquals(src, src2));\n    \n    // entry by entry copy\n    File src3 = new File(getClass().getResource(\"demo-copy-II.zip\").getPath());\n    assertTrue(ZipUtil.archiveEquals(src, src3));\n  }\n  \n  public void testRepackArchive() throws IOException {\n    File src = new File(getClass().getResource(\"demo.zip\").getPath());\n    File dest = File.createTempFile(\"temp\", null);\n\n    ZipUtil.repack(src, dest, 1);\n\n    assertTrue(ZipUtil.archiveEquals(src, dest));\n  }\n\n\n  public void testContainsAnyEntry() throws IOException {\n    File src = new File(getClass().getResource(\"demo.zip\").getPath());\n    boolean exists = ZipUtil.containsAnyEntry(src, new String[] { \"foo.txt\", \"bar.txt\" });\n    assertTrue(exists);\n\n    exists = ZipUtil.containsAnyEntry(src, new String[] { \"foo.txt\", \"does-not-exist.txt\" });\n    assertTrue(exists);\n\n    exists = ZipUtil.containsAnyEntry(src, new String[] { \"does-not-exist-I.txt\", \"does-not-exist-II.txt\" });\n    assertFalse(exists);\n  }\n\n  public void testAddEntry() throws IOException {\n    File src = new File(getClass().getResource(\"demo.zip\").getPath());\n    final String fileName = \"TestFile.txt\";\n    assertFalse(ZipUtil.containsEntry(src, fileName));\n    File newEntry = new File(getClass().getResource(fileName).getPath());\n    File dest = File.createTempFile(\"temp.zip\", null);\n\n    ZipUtil.addEntry(src, fileName, newEntry, dest);\n    assertTrue(ZipUtil.containsEntry(dest, fileName));\n  }\n\n  public void testRemoveEntry() throws IOException {\n    File src = new File(getClass().getResource(\"demo.zip\").getPath());\n\n    File dest = File.createTempFile(\"temp\", null);\n    try {\n      ZipUtil.removeEntry(src, \"bar.txt\", dest);\n      assertTrue(\"Result zip misses entry 'foo.txt'\", ZipUtil.containsEntry(dest, \"foo.txt\"));\n      assertTrue(\"Result zip misses entry 'foo1.txt'\", ZipUtil.containsEntry(dest, \"foo1.txt\"));\n      assertTrue(\"Result zip misses entry 'foo2.txt'\", ZipUtil.containsEntry(dest, \"foo2.txt\"));\n      assertFalse(\"Result zip still contains 'bar.txt'\", ZipUtil.containsEntry(dest, \"bar.txt\"));\n    }\n    finally {\n      FileUtils.deleteQuietly(dest);\n    }\n  }\n\n  public void testRemoveDirs() throws IOException {\n    File src = new File(getClass().getResource(\"demo-dirs.zip\").getPath());\n\n    File dest = File.createTempFile(\"temp\", null);\n    try {\n      ZipUtil.removeEntries(src, new String[] { \"bar.txt\", \"a/b\" }, dest);\n\n      assertFalse(\"Result zip still contains 'bar.txt'\", ZipUtil.containsEntry(dest, \"bar.txt\"));\n      assertFalse(\"Result zip still contains dir 'a/b'\", ZipUtil.containsEntry(dest, \"a/b\"));\n      assertTrue(\"Result doesn't containt 'attic'\", ZipUtil.containsEntry(dest, \"attic/treasure.txt\"));\n      assertTrue(\"Entry whose prefix is dir name is removed too: 'b.txt'\", ZipUtil.containsEntry(dest, \"a/b.txt\"));\n      assertFalse(\"Entry in a removed dir is still there: 'a/b/c.txt'\", ZipUtil.containsEntry(dest, \"a/b/c.txt\"));\n\n    }\n    finally {\n      FileUtils.deleteQuietly(dest);\n    }\n  }\n}\n"
}